#include <std/assert>
// this test needs the 'allow_unsafe' key to be true
// pointers are considered unsafe in Lucia
#config allow_unsafe = true

p: &int = &10

fun f(f: function[&int] -> int, a: &int) -> int: f(a) end

fun g(a: &int) -> int:
    return *a
end

assert_eq!(f(g, p), 10)

fun set_ptr(p: &int, v: int) -> void:
    // def not stolen syntax again
    *p = v
    return
end

set_ptr(p, 20)
assert_eq!((*p), 20)

// nested pointers and flattening

pp := &(&30)

// ++ operator flatters pointers
flattened_p: int = ++pp

assert_eq!(flattened_p, 30)

pp: any = 10

for i in [0..10]:
    pp = &pp
end

assert!(pp is &any)  // yes
flattened_p2: int = ++pp
assert_eq!(flattened_p2, 10)
